<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport"
		  content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>为 GeekNav 添加导航</title>

	<!-- AmazeUI -->
	<link rel="stylesheet" href="//cdn.amazeui.org/amazeui/2.7.2/css/amazeui.min.css">
	<script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
	<script src="//cdn.amazeui.org/amazeui/2.7.2/js/amazeui.min.js"></script>

	<!-- 存储服务 -->
	<script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.11.1/dist/av-min.js"></script>
	<!-- 实时消息服务 -->
	<script src="//cdn.jsdelivr.net/npm/leancloud-realtime@4.2.1/dist/realtime.browser.min.js"></script>
	<style>
		.header {
			font-size: 150%;
			text-align: center;
			margin-top: 30px;
		}
		.header p {
			font-size: 14px;
		}
		.require {
			color: #cd3a28;
		}
	</style>
</head>
<body>

<header class="header">
	<h1>添加导航</h1>
	<p>为 <a href="http://geek.2015wuji01.net/">GeekNav</a> 添加一个新的导航链接</p>
</header>

<hr class="am-margin-0">

<div class="am-g am-padding-vertical">
	<form class="am-form am-u-lg-6 am-u-md-8 am-u-sm-centered">
		<section>
			<label for="siteUrl">网址 <span class="require">*</span></label>
			<input id="siteUrl" class="am-radius" type="text" name="siteUrl" placeholder="例如：https://www.2015wuji01.net/" required>
			<br>

			<label class="" for="siteType">站点分类 <span class="require">*</span>
			</label>
			<a class="am-fr am-margin-right-sm" href="javascript:;" onclick=addType()><i class="am-icon-plus"></i></a>
			<select id="siteType" class="am-radius" name="siteType" required>
				<option value="常用网址">常用网址</option>
				<option value="个人博客">个人博客</option>
				<option value="慕课视频">慕课视频</option>
				<option value="小工具">小工具</option>
				<option value="资源分享">资源分享</option>
			</select>
			<br>

			<label for="siteName">站点名称 <span class="require">*</span></label>
			<input id="siteName" class="am-radius" type="text" name="siteName" required>
			<br>

			<label for="siteDesc">站点描述</label>
			<textarea id="siteDesc" class="am-radius" name="siteDesc" id="" cols="30" rows="3"></textarea>
			<br>

			<a class="am-btn am-btn-success am-radius am-fr" onclick="submit()">提交</a>
		</section>
	</form>
</div>

<script>
	function addType() {
		$('#siteType').after('<input id="siteType" class="am-radius" type="text" name="siteType" placeholder="请输入自定义分类" required>').remove();
	}

	function createNav(siteUrl, siteType, siteName, siteDesc) {
		let APP_ID = 'pwI6FkfK77zJMpuRp4fJVuD5-gzGzoHsz';
		let APP_KEY = 'HEGfFXGJR5XnmgD6dIVixqBO';
		AV.init({
			appId: APP_ID,
			appKey: APP_KEY
		});
		// 创建一个 GeekNav 对象
		let GeekNav = AV.Object.extend('GeekNav');
		let geekNav = new GeekNav();
		geekNav.save({
			// 将对应数据以键值对方式保存
			url: siteUrl,
			name: siteName,
			type: siteType,
			description: siteDesc,
		}).then(function(object) {
			alert('提交成功!');
			console.log('siteUrl:' + siteUrl);
			console.log('siteName' + siteName);
			console.log('siteType' + siteType);
			console.log('siteDesc' + siteDesc);
		}, function (error) {
			console.log(error);
		})
	}

	function submit() {
		let url = $('#siteUrl').val();
		let type = $('#siteType').val();
		let name = $('#siteName').val();
		let description = $('#siteDesc').val();
		// 如果必填项均不为空，则存入数据库
		if (url && type && name) {
			createNav(url, type, name, description)
		}
	}
</script>
</body>
</html>
